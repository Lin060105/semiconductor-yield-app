name: CI Pipeline

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  # ğŸŒŸ æ»¿åˆ†é—œéµ 1ï¼šåŠ å…¥ Lint æª¢æŸ¥ï¼Œç¢ºä¿ç¨‹å¼ç¢¼æ’ç‰ˆèˆ‡èªæ³•ä¹¾æ·¨
  lint:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Set up Python 3.9
      uses: actions/setup-python@v4
      with:
        python-version: 3.9
    - name: Install flake8
      run: |
        python -m pip install --upgrade pip
        pip install flake8
    - name: Lint with flake8
      run: |
        # æ•æ‰åš´é‡çš„èªæ³•éŒ¯èª¤èˆ‡æœªå®šç¾©è®Šæ•¸
        flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
        # å…è¨±ä¸€äº›æ’ç‰ˆä¸Šçš„å°ç‘•ç–µä¸ä¸­æ–· CIï¼Œä½†åˆ—å‡ºè­¦å‘Š (é•·åº¦æ”¾å¯¬è‡³127)
        flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics

  # åŸ·è¡Œå–®å…ƒæ¸¬è©¦
  test:
    needs: lint  # å¿…é ˆå…ˆé€šé lint æ‰æœƒè·‘æ¸¬è©¦
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Set up Python 3.9
      uses: actions/setup-python@v4
      with:
        python-version: 3.9
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        # å„ªå…ˆå®‰è£æˆ‘å€‘é–å®šçš„ç©©å®šç‰ˆæœ¬
        pip install scikit-learn==1.3.0 pycaret==3.0.0
        pip install -r requirements.txt
        pip install pytest
    - name: Run tests with pytest
      run: |
        pytest tests/